/* --------------------------------------------------------------------
 * jQuery Visualize 'Extended' plugin
 *
 * Original Author: Scott Jehl, scott@filamentgroup.com
 * Copyright (c) 2009 Filament Group
 * licensed under MIT (filamentgroup.com/examples/mit-license.txt)
 *
 * Extended version
 * Author: Christophe Desguez, https://github.com/zipang
 * https://github.com/zipang/jQuery-Visualize
 * -------------------------------------------------------------------- */(function(e){function s(t,n){if(e.visualize.plugins[t])n(e.visualize.plugins[t]);else{var r="/plugins/jquery.visualize."+t.split(/[-_]/)[0]+".js";e.ajax({url:r,dataType:"script",async:!1,success:function(){if(!e.visualize.plugins[t])throw"Failed to load jquery.vizualize plugin "+t+" in following location : "+this.url+"\n";n(e.visualize.plugins[t])},error:function(e,n,r){throw"Failed to load jquery.vizualize plugin "+t+" in following location : "+this.url+"\n"+r.message}})}}function o(e){return e}function u(t){e.extend(this,t)}function a(t,n){this.table=e(t),this.options=n,this.parse()}e.visualize={plugins:{}},Array.max=function(e){return!e||e.length==0?undefined:Math.max.apply(Array,e)},Array.min=function(e){return!e||e.length==0?undefined:Math.min.apply(Array,e)},Array.sum=function(e){var t=e&&e.length?e.length:0,n=0,r;for(var i=0;i<t;i++)r=parseFloat(e[i]),n+=!e[i]||isNaN(e[i])?0:r;return n},Array.avg=function(e){var t=e&&e.length?e.length:0;return t?Array.sum(e)/t:0};var t=36e5,n=t*24,r=n*7,i={h:t,hours:t,d:n,days:n,w:r,weeks:r};Date.add=function(e,t,n){if(i[n])return new Date(e.getTime()+t*i[n]);if(n=="m"||n=="months")return new Date(Date.UTC(e.getFullYear(),e.getMonth()+t,e.getDate()));if(n=="y"||n=="years")return new Date(Date.UTC(e.getFullYear()+t,e.getMonth(),e.getDate()))},Date.elapsed=function(e,t,n){if(i[e])return(n-t)/i[e];if(e=="m"||e=="months")return(t.getFullYear()+t.getMonth()*12-n.getFullYear()+n.getMonth()*12)/12;if(e=="y"||e=="years")return t.getFullYear()-n.getFullYear()},e.visualize.getRangeLabels=function(e,t,n){var r=t-e,n=n>=r?r+1:n,i=n-1,s,o=[];o.push(e);for(var u=1;u<i;u++)s=e+r/i*u,Math.abs(s)<10?o.push(s%1==0?s:Math.ceil(s*100)/100):o.push(Math.floor(s));return o.push(t),o},u.prototype={keys:function(){return this._keys||[]},drawDateRange:function(t,r,i){var s=this.target.canvasContext,o=this.target.canvas,u=o.width(),a=o.height(),f=0,l=t,c=["Jan","Fev","Mar","Avr","Mai","Jun","Jui","Aou","Sep","Oct","Nov","Dec"],h=(r-t)/n+1,p=h==0?u:u/h,d=function(e,t){s.beginPath(),s.lineWidth=[.1,2,3][t],s.moveTo(p*e,0),s.lineTo(p*e,a),s.strokeStyle=i.lineColors[t],s.stroke(),s.closePath()},v=function(e){s.beginPath(),s.lineWidth=p*2,s.moveTo(p*(e+1),0),s.lineTo(p*(e+1),a),s.strokeStyle=i.lineColors[3],s.stroke(),s.closePath()},m=e("<ul>").addClass("visualize-labels-x").width(u).height(a).insertBefore(o);while(l<=r){var g=l.getDate(),y=e("<span>").addClass("label").html(g);e("<li>").css("left",p*f).width(p).append(y).appendTo(m),(y.width()>p*(g<10?.5:.9)&&g%5&&g!=1||g==30&&y.width()>p*1.9)&&y.remove(),l.getDay()==6&&v(f),g==1?(y.append(e("<br>")).append(c[l.getMonth()]),l.getMonth()?d(f,1):(d(f,2),y.append(e("<br>")).append(l.getFullYear()))):d(f,0),l=new Date(l.getTime()+n),f++}},drawXAxis:function(t,n){var n=e.extend({},n),r=this.target.canvasContext,i=this.target.canvas,s=i.width(),u=i.height(),a=n.centerLabels!==undefined?n.centerLabels:isNaN(t[0]),f=n.drawLines!==undefined?n.drawLines:!a,l=n.format||o,c=t.length-(a?0:1),h=c==0?s:s/c,p=e("<ul>").addClass("visualize-labels visualize-labels-x").width(s).height(u).insertBefore(i);a?e.each(t,function(t,n){var r=e("<span>").addClass("label").css({width:"100%",textAlign:"center"}).html(l(n));e("<li>").css("left",h*t).width(h).append(r).appendTo(p)}):e.each(t,function(t,n){var r=e("<span>").addClass("label").html(l(n));e("<li>").css("left",h*t).width(h).append(r).appendTo(p),t>0&&r.css("margin-left",-0.5*r.width())}),f&&(r.beginPath(),r.lineWidth=.1,e.each(t,function(e,t){r.moveTo(h*(e+1),0),r.lineTo(h*(e+1),u)}),r.strokeStyle=this.options.lineColors[0],r.stroke(),r.closePath())},drawYAxis:function(t,n){var n=e.extend({},n),r=this.target.canvasContext,i=this.target.canvas,s=i.width(),u=i.height(),a=n.centerLabels!==undefined?n.centerLabels:isNaN(t[0]),f=n.drawLines!==undefined?n.drawLines:!a,l=n.format||o,c=t.length-(a?0:1),h=c==0?u:u/c,p=e("<ul>").addClass("visualize-labels visualize-labels-y").width(s).height(u).insertBefore(i);e.each(t,function(t,r){var i=e("<span>").addClass("label").html(l(r));e("<li>").css(n.fromTop?"top":"bottom",h*t+(a?h/2:0)).append(i).prependTo(p),i.css("margin-top",-0.5*i.height())}),f&&(r.beginPath(),r.lineWidth=.1,e.each(t,function(e,t){r.moveTo(0,h*(e+1)),r.lineTo(s,h*(e+1))}),r.strokeStyle=this.options.lineColors[0],r.stroke(),r.closePath())}},a.prototype={parse:function(){var t=this.options.rowFilter,n=this.options.colFilter,r=[],i=[],s=[],o=this.options.parser||parseFloat;e("tr",this.table).filter(t).each(function(t,u){var a=[];e("th, td",e(u)).filter(n).each(function(n,r){a.push(t==0||n==0?e(r).text():o(e(r).text()))}),t==0?(a.shift(),s=a):(i.push(a.shift()),r.push(a))});var u=r.length,a=r[0].length,f=[];for(var l=0;l<a;l++){var c=[];for(var h=0;h<u;h++)c.push(r[h][l]);f.push(c)}this.lineHeaders=i,this.columnHeaders=s,this.lines=r,this.columns=f}};var f={type:"bar",appendTitle:!0,title:null,appendKey:!0,rowFilter:" ",colFilter:" ",colors:["#be1e2d","#666699","#92d5ea","#ee8310","#8d10ee","#5a3b16","#26a4ed","#f45a90","#e9e744"],lineColors:["#777","#aaa","#eee"],textColors:[],parseDirection:"x",pieMargin:20,pieLabelsAsPercent:!0,pieLabelPos:"inside",lineWeight:4,barGroupMargin:10,barMargin:1,yLabelInterval:30};e.fn.visualize=function(t,n,r){typeof t!="string"&&(r=n,n=t||{},t=n.type||f.type);var i=e(this);return s(t,function(o){var l=e.extend({},f,o.defaults,n);o.parser&&(l.parser=o.parser),i.each(function(){var n=e(this),i=l.width=parseFloat(l.width||n.width()),s=l.height=parseFloat(l.height||n.height());l.ticks=+l.ticks||Math.ceil(s/l.yLabelInterval);var f=e("<canvas>").attr("height",s).attr("width",i),c=l.title||n.find("caption").text(),h=(r||e("<div>")).addClass("visualize").addClass("visualize-"+t).attr("role","img").attr("aria-label","Chart representing data from the table: "+c).height(s).width(i).append(f);r||h.insertAfter(n),typeof G_vmlCanvasManager!="undefined"&&(G_vmlCanvasManager.init(),G_vmlCanvasManager.initElement(f[0]));var p=new a(n,l),d=new u({data:p,target:{container:h,canvas:f,canvasContext:f[0].getContext("2d")},options:l});o.apply(d);if(l.appendTitle||l.appendKey){var v=e("<div>").addClass("visualize-info").appendTo(h);l.appendTitle&&e("<div>").addClass("visualize-title").html(c).appendTo(v);if(l.appendKey){var m=e("<ul>").addClass("visualize-key");e.each(d.keys(),function(t,n){e("<li>").append(e("<span>").addClass("visualize-key-color").css("background",l.colors[t])).append(e("<span>").addClass("visualize-key-label").html(n)).appendTo(m)}),m.appendTo(v)}}r||h.bind("visualizeRefresh",function(){n.visualize(l,e(this).empty())})})}),i}})(jQuery),function(){var t=$.visualize.plugins.bar=function(){var e=this.options,t=this.target.canvasContext,n=this.target.canvas,r=n.width(),i=n.height(),s=this.data,o=e.parseDirection=="x"?s.lines:s.columns,u=Math.ceil(Array.max($.map(o,Array.max))),a=Math.floor(Array.min($.map(o,Array.min))),f=u-(a>0?a=0:a),l=$.visualize.getRangeLabels(a,u,e.ticks),c=e.parseDirection=="x"?s.columnHeaders:s.lineHeaders;this._keys=e.parseDirection=="x"?s.lineHeaders:s.columnHeaders,this.drawXAxis(c),this.drawYAxis(l);var h=c.length!=0?r/c.length:r,p=f!=0?i/f:i,d=i-(a<0?-a:0)*p;for(var v=0;v<o.length;v++){t.strokeStyle=e.colors[v];var m=(h-e.barGroupMargin*2)/o.length;t.lineWidth=m-e.barMargin*2;var g=o[v];for(var y=0;y<g.length;y++){t.beginPath();var b=y*h+e.barGroupMargin+v*m+m/2;t.moveTo(b,d),t.lineTo(b,Math.round(-g[y]*p)+d),t.stroke(),t.closePath()}}}}(),function(){var t=$.visualize.plugins.pie=function(){var e=this.options,t=this.target.canvasContext,n=this.target.canvas,r=n.width(),i=n.height(),s=this.data,o=e.parseDirection=="x"?s.lines:s.columns,u=$.map(o,Array.sum),a=Array.sum(u);this._keys=e.parseDirection=="x"?s.lineHeaders:s.columnHeaders,e.pieLabelPos=="outside"&&this.target.container.addClass("visualize-pie-outside");var f=Math.round(r/2),l=Math.round(i/2),c=l-e.pieMargin,h=0,p=$('<ul class="visualize-labels"></ul>').insertAfter(n);$.each(u,function(n,r){var i=r<=0||isNaN(r)?0:r/a;i>0&&(t.beginPath(),t.moveTo(f,l),t.arc(f,l,c,h*Math.PI*2-Math.PI*.5,(h+i)*Math.PI*2-Math.PI*.5,!1),t.lineTo(f,l),t.closePath(),t.fillStyle=e.colors[n],t.fill());var s=h+i/2,o=e.pieLabelPos=="inside"?c/1.6:c+c/5,u=Math.round(f+Math.sin(s*Math.PI*2)*o),d=Math.round(l-Math.cos(s*Math.PI*2)*o),v=u>f?"right":"left",m=d>l?"bottom":"top",g=parseFloat((i*100).toFixed(2));if(g){var y=e.pieLabelsAsPercent?g+"%":r,b=$('<span class="visualize-label">'+y+"</span>").css({leftRight:0,topBottom:0}),w=$('<li class="visualize-label-pos"></li>').append(b).appendTo(p).css({left:u,top:d});b.css("font-size",c/10).css("margin-"+v,-b.width()/2).css("margin-"+m,-b.outerHeight()/2),e.textColors[n]&&b.css("color",e.textColors[n])}h+=i})}}(),function(){var t=$.visualize.plugins.line=function(e){var t=$.extend({},this.options),n=this.target.canvasContext,r=this.target.canvas,i=r.width(),s=r.height(),o=this.data,u=t.parseDirection=="x"?o.lines:o.columns,a=Math.ceil(Array.max($.map(u,Array.max))),f=Math.floor(Array.min($.map(u,Array.min))),l=a-(f>0?f=0:f),c=$.visualize.getRangeLabels(f,a,t.ticks),h=l!=0?s/l:s,p=t.parseDirection=="x"?o.columnHeaders:o.lineHeaders,d=p.length!=1?i/(p.length-1):i;this._keys=t.parseDirection=="x"?o.lineHeaders:o.columnHeaders,this.drawXAxis(p,{centerLabels:!1}),this.drawYAxis(c),$.each(u,function(r,o){n.beginPath(),n.lineWidth=t.lineWeight,n.lineJoin="round",n.moveTo(0,s-h*o[0]);for(var u=0;u<o.length;u++)n.lineTo(d*u,s-h*o[u]);n.strokeStyle=t.colors[r],n.stroke(),e?(n.lineTo(i,s),n.lineTo(0,s),n.closePath(),n.fillStyle=t.colors[r],n.globalAlpha=.3,n.fill(),n.globalAlpha=1):n.closePath()})};$.visualize.plugins.area=function(){t.call(this,!0)}}(),function(){var t={normalize:!1,ticks:7};$.visualize.plugins.stack_100=function(){this.options.normalize=!0,this.options.ticks=5,n.call(this)};var n=$.visualize.plugins.stack=function(){var e=$.extend({},t,this.options),n=this.target.canvasContext,r=this.target.canvas,i=r.width(),s=r.height(),o=this.data,u=e.parseDirection=="x"?o.columns:o.lines,a=e.parseDirection=="x"?o.columnHeaders:o.lineHeaders,f=$.map(u,Array.sum),l=e.normalize?100:Array.max(f),c=$.visualize.getRangeLabels(0,l,e.ticks);this._keys=e.parseDirection=="x"?o.lineHeaders:o.columnHeaders,this.drawXAxis(a);var h=e.normalize?{format:function(e){return e+"%"}}:{};this.drawYAxis(c,h);var p=a.length!=0?i/a.length:i,d=l!=0?s/l:s;for(var v=0;v<u.length;v++){n.lineWidth=p-(e.barMargin+e.barGroupMargin)*2;var m=u[v],g=p*v+p/2,y=s,b=e.normalize?100/Array.sum(m):1;for(var w=0;w<m.length;w++){var E=Math.round(m[w]*d*b);n.beginPath(),n.strokeStyle=e.colors[w],n.moveTo(g,y),n.lineTo(g,y-E),n.stroke(),n.closePath(),y-=E}}}}(),function(){var t=$.visualize.plugins.hbar=function(){var e=this.options,t=this.target.canvasContext,n=this.target.canvas,r=n.width(),i=n.height(),s=this.data,o=e.parseDirection=="x"?s.lines:s.columns,u=Math.ceil(Array.max($.map(o,Array.max))),a=Math.floor(Array.min($.map(o,Array.min))),f=u-(a>0?a=0:a),l=$.visualize.getRangeLabels(a,u,e.ticks),c=e.parseDirection=="x"?s.columnHeaders:s.lineHeaders;this._keys=e.parseDirection=="x"?s.lineHeaders:s.columnHeaders,this.drawXAxis(l),this.drawYAxis(c,{drawLines:!0});var h=f!=0?r/f:r,p=c.length!=0?i/c.length:i,d=(a<0?-a:0)*h;for(var v=0;v<o.length;v++){t.beginPath();var m=(p-e.barGroupMargin*2)/o.length;t.lineWidth=m-e.barMargin*2;var g=o[v];for(var y=0;y<g.length;y++){var b=y*p+e.barGroupMargin+v*m+m/2;t.moveTo(d,b),t.lineTo(Math.round(g[y]*h)+d,b)}t.strokeStyle=e.colors[v],t.stroke(),t.closePath()}}}(),function(){var t={normalize:!1,ticks:7};$.visualize.plugins.hstack_100=function(){this.options.normalize=!0,this.options.ticks=5,n.call(this)};var n=$.visualize.plugins.hstack=function(){var e=$.extend({},t,this.options),n=this.target.canvasContext,r=this.target.canvas,i=r.width(),s=r.height(),o=this.data,u=e.parseDirection=="x"?o.lines:o.columns,a=$.map(u,Array.sum),f=e.normalize?100:Array.max(a),l=$.visualize.getRangeLabels(0,f,e.ticks),c=e.parseDirection=="x"?o.lineHeaders:o.columnHeaders;this._keys=e.parseDirection=="x"?tabledata.columnHeaders:tabledata.lineHeaders;var h=e.normalize?{format:function(e){return e+"%"}}:{};this.drawXAxis(l,h),this.drawYAxis(c);var p=f!=0?i/f:i,d=c.length!=0?s/c.length:s;for(var v=0;v<u.length;v++){n.lineWidth=d-(e.barMargin+e.barGroupMargin)*2;var m=u[v],g=0,y=s-d*v-d/2,b=e.normalize?100/Array.sum(m):1;for(var w=0;w<m.length;w++){var E=Math.round(m[w]*p*b);n.beginPath(),n.strokeStyle=e.colors[w],n.moveTo(g,y),n.lineTo(g+E,y),n.stroke(),n.closePath(),g+=E}}}}();